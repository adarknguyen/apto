<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Arrow with Curve Control</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        #canvas {
            position: relative;
            width: 600px;
            height: 400px;
            border: 2px solid #333;
        }

        #svgCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .point {
            width: 15px;
            height: 15px;
            background-color: red;
            border-radius: 50%;
            position: absolute;
            cursor: pointer;
        }

        .dragging {
            opacity: 0.5;
        }

        #arrowPath {
            fill: none;
            stroke: green;
            stroke-width: 2;
            marker-end: url(#arrowhead);
        }

        /* Định nghĩa đầu mũi tên */
        <defs>
            <marker id="arrowhead" viewBox="0 0 10 10" refX="5" refY="5" orient="auto" markerWidth="8" markerHeight="8">
                <path d="M 0 0 L 10 5 L 0 10 z" fill="green" />
            </marker>
        </defs>
    </style>
</head>
<body>

    <div id="canvas">
        <!-- SVG Canvas -->
        <svg id="svgCanvas">
            <!-- Đường mũi tên -->
            <path id="arrowPath" d="M 100 100 C 250 50, 350 150, 500 100" />
            <!-- Định nghĩa đầu mũi tên -->
            <defs>
                <marker id="arrowhead" viewBox="0 0 10 10" refX="5" refY="5" orient="auto" markerWidth="8" markerHeight="8">
                    <path d="M 0 0 L 10 5 L 0 10 z" fill="green" />
                </marker>
            </defs>
        </svg>

        <!-- Các điểm kéo -->
        <div id="point1" class="point" style="left: 100px; top: 100px;"></div> <!-- Điểm bắt đầu mũi tên -->
        <div id="point2" class="point" style="left: 500px; top: 100px;"></div> <!-- Điểm kết thúc mũi tên -->
        <div id="controlPoint" class="point" style="left: 300px; top: 50px;"></div> <!-- Điểm điều khiển độ cong -->
    </div>

    <script>
        const arrowPath = document.getElementById('arrowPath');
        const point1 = document.getElementById('point1');
        const point2 = document.getElementById('point2');
        const controlPoint = document.getElementById('controlPoint');

        let isDragging = false;
        let currentPoint = null;

        // Cập nhật đường cong Bézier
        function updateArrow() {
            const x1 = parseFloat(point1.style.left);
            const y1 = parseFloat(point1.style.top);
            const x2 = parseFloat(point2.style.left);
            const y2 = parseFloat(point2.style.top);
            const cx = parseFloat(controlPoint.style.left);
            const cy = parseFloat(controlPoint.style.top);

            // Cập nhật lại đường Bézier
            const d = `M ${x1} ${y1} C ${cx} ${cy}, ${cx} ${cy}, ${x2} ${y2}`;
            arrowPath.setAttribute('d', d);
        }

        // Tính toán và giữ điểm chính giữa luôn nằm trên thân mũi tên
        function updateControlPointPosition() {
            const x1 = parseFloat(point1.style.left);
            const y1 = parseFloat(point1.style.top);
            const x2 = parseFloat(point2.style.left);
            const y2 = parseFloat(point2.style.top);

            // Tính toán vị trí điểm giữa
            const controlX = (x1 + x2) / 2;
            const controlY = (y1 + y2) / 2;

            controlPoint.style.left = `${controlX - controlPoint.offsetWidth / 2}px`;
            controlPoint.style.top = `${controlY - controlPoint.offsetHeight / 2}px`;
        }

        // Khi bắt đầu kéo
        function startDragging(event, point) {
            isDragging = true;
            currentPoint = point;
            point.classList.add('dragging');
        }

        // Khi kéo chuột
        function drag(event) {
            if (!isDragging || !currentPoint) return;

            const offsetX = event.clientX - document.getElementById('canvas').offsetLeft;
            const offsetY = event.clientY - document.getElementById('canvas').offsetTop;

            currentPoint.style.left = `${offsetX - currentPoint.offsetWidth / 2}px`;
            currentPoint.style.top = `${offsetY - currentPoint.offsetHeight / 2}px`;

            if (currentPoint === controlPoint) {
                updateArrow(); // Cập nhật mũi tên khi kéo điểm điều khiển
            } else {
                // Khi kéo các điểm đầu và cuối, cũng cần cập nhật lại vị trí của điểm chính giữa
                updateControlPointPosition();
                updateArrow(); // Cập nhật lại mũi tên khi kéo
            }
        }

        // Khi thả chuột
        function stopDragging() {
            isDragging = false;
            if (currentPoint) {
                currentPoint.classList.remove('dragging');
            }
        }

        // Gán sự kiện cho các điểm kéo
        point1.addEventListener('mousedown', (event) => startDragging(event, point1));
        point2.addEventListener('mousedown', (event) => startDragging(event, point2));
        controlPoint.addEventListener('mousedown', (event) => startDragging(event, controlPoint));

        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', stopDragging);

        // Cập nhật mũi tên ban đầu
        updateArrow();
        updateControlPointPosition();
    </script>

</body>
</html>

/*
Tạo một trang HTML với SVG để vẽ một mũi tên có 2 điểm đầu và một điểm chính giữa. Điểm chính giữa luôn nằm trên thân mũi tên và có thể kéo để thay đổi độ cong của mũi tên. Khi kéo điểm đầu và điểm cuối, điểm chính giữa sẽ tự động di chuyển theo để giữ đúng vị trí trên thân mũi tên. Mũi tên được vẽ bằng đường Bézier, và khi kéo điểm điều khiển, độ cong của mũi tên sẽ thay đổi. Các hành động kéo không trả về trạng thái ban đầu mà cập nhật liên tục.
*/